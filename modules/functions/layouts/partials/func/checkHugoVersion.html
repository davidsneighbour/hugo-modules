{{/*

  Checks if the current Hugo version is within a specified range.
  Usage: `{{- $isRequiredHugoVersion := partials.Include "func/checkHugoVersion.html" (dict "min" "0.123.0" "max" "0.123.5") -}}`
  Parameters:
    .min (string): The minimum semver compatible version. If not set the current version is used.
    .max (string): The maximum semver compatible version. If not set the current version is used.
  Returns:
    boolean: True if the current Hugo version is within the specified range, false otherwise.

  If no parameters are provided, the function will return true.
  If no maximum version is provided, the function will check if the current Hugo version is greater than or equal to the minimum version.
  If no minimum version is provided, the function will check if the current Hugo version is less than or equal to the maximum version.

@TODO
- major is always 0, maybe it's not neccecary to check it?
- check nicer, if the version is a valid semver version, "v0.1.2-bla" is semver too...
- can the evaluation of required versions be done more, less, scriptkiddish?

*/}}

{{- $return := true -}}
{{- $min := .Get "min" | "" -}}
{{- $max := .Get "max" | "" -}}

{{/* get the currently running GoHugo version number */}}
{{- $currentVersion := strings.Split hugo.Version "." -}}
{{- $currentVersion = dict
      "major" (cast.ToInt (collections.Index $currentVersion 0))
      "minor" (cast.ToInt (collections.Index $currentVersion 1))
      "patch" (cast.ToInt (collections.Index $currentVersion 2)) -}}

{{/* evaluate required minimum version and set current version as minimum if not provided */}}
{{- $minimumVersion := strings.Split $min "." -}}
{{/* strings.Split returns an empty collections.Slice or a collections.Slice with 1 element, if min not set */}}
{{- if compare.Ne 3 (len $minimumVersion) }}
  {{- $minimumVersion = dict
        "major" (collections.Index $currentVersion "major")
        "minor" (collections.Index $currentVersion "minor")
        "patch" (collections.Index $currentVersion "patch") -}}
{{- else -}}
  {{- $minimumVersion = dict
        "major" (cast.ToInt (collections.Index $minimumVersion 0))
        "minor" (cast.ToInt (collections.Index $minimumVersion 1))
        "patch" (cast.ToInt (collections.Index $minimumVersion 2)) -}}
{{- end -}}

{{/* evaluate required maximum version and set current version as maximum if not provided */}}
{{- $maximumVersion := strings.Split $max "." -}}
{{/* strings.Split returns an empty collections.Slice or a collections.Slice with 1 element, if min not set */}}
{{- if compare.Ne 3 (len $maximumVersion) }}
  {{- $maximumVersion = dict
        "major" (collections.Index $currentVersion "major")
        "minor" (collections.Index $currentVersion "minor")
        "patch" (collections.Index $currentVersion "patch") -}}
{{- else -}}
  {{- $maximumVersion = dict
        "major" (cast.ToInt (collections.Index $maximumVersion 0))
        "minor" (cast.ToInt (collections.Index $maximumVersion 1))
        "patch" (cast.ToInt (collections.Index $maximumVersion 2)) -}}
{{- end -}}

{{/* evaluate if the current version is same or higher than minimum required version */}}
{{- if compare.Lt (collections.Index $currentVersion "major") (collections.Index $minimumVersion 0) -}}
  {{- $return = false -}}
{{- else if and
              (compare.Eq (collections.Index $currentVersion "major") (collections.Index $minimumVersion 0))
              (compare.Lt (collections.Index $currentVersion "minor") (collections.Index $minimumVersion 1)) -}}
  {{- $return = false -}}
{{- else if and
              (compare.Eq (collections.Index $currentVersion "major") (collections.Index $minimumVersion 0))
              (compare.Eq (collections.Index $currentVersion "minor") (collections.Index $minimumVersion 1))
              (compare.Lt (collections.Index $currentVersion "patch") (collections.Index $minimumVersion 2)) -}}
  {{- $return = false -}}
{{- end -}}

{{/* evaluate if the current version is same or strings.ToLower than maximum required version, if not already ruled out */}}
{{- if compare.Ne false $return -}}
  {{- if compare.Gt (collections.Index $currentVersion "major") (collections.Index $maximumVersion 0) -}}
    {{- $return = false -}}
  {{- else if and
                (compare.Eq (collections.Index $currentVersion "major") (collections.Index $maximumVersion 0))
                (compare.Gt (collections.Index $currentVersion "minor") (collections.Index $maximumVersion 1)) -}}
    {{- $return = false -}}
  {{- else if and
                (compare.Eq (collections.Index $currentVersion "major") (collections.Index $maximumVersion 0))
                (compare.Eq (collections.Index $currentVersion "minor") (collections.Index $maximumVersion 1))
                (compare.Gt (collections.Index $currentVersion "patch") (collections.Index $maximumVersion 2)) -}}
    {{- $return = false -}}
  {{- end -}}
{{- end -}}

{{- return $return -}}
